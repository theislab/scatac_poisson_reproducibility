# Experiment configuration file.

seml:
  executable: poisson_atac/experiments/atac_to_atac/experiment_runner.py
  name: ATAC_ATAC_prediction
  output_dir: poisson_atac/experiments/atac_to_atac/logs
  project_root_dir: /data/nasif12/home_if12/martensl/github_repos/scatac_poisson_private/
  conda_environment: poisson_atac_new
slurm:
  experiments_per_job: 1
  max_simultaneous_jobs: 10
  sbatch_options_template: GPU
  sbatch_options:
     gres: gpu:1       # num GPUs
     mem: 200G          # memory
     cpus-per-task: 8  # num cores
     time: 2-00:01     # max time, D-HH:MM #TODO: Adjust time to 12:00

###### BEGIN PARAMETER CONFIGURATION ######

fixed:
  training.max_epochs: 500 
  training.model_path: "/s/project/poisson_atac/models/"
  training.save_path: "/s/project/poisson_atac/benchmark/"
  training.project_name: "atac_to_atac"
  optimization.regularization:
    weight_decay: 1e-3
    learning_rate: 1e-4

grid:
  scvi.seed:
    type: choice
    options: 
        - 0
        - 1
        - 2
        - 3
        - 4
        - 5
        - 6
        - 7
        - 8
        - 9

# Evaluation over multiple train, val, test sets for statistics using all batches
# Using best n_latent from initial sweep: see notebooks
# Cross_validation_NeurIPS:
#   fixed:
#     #data
#     data.dataset: "neurips" #only testing on Neurips
#     setup.batch_key: "batch"
#     setup.label_key: "cell_type"
#     data.batch: None # all training & test batches

#   Poissonvi_observed:
#     fixed:
#       model.model_type: "poissonvi"
#       setup.layer: "counts" #using count layer
#       setup.model_params.n_latent: 100
#       setup.model_params.use_observed_lib_size: True

#   Peakvi:
#     fixed:
#       model.model_type: "peakvi"
#       setup.layer: None #using binary data
#       setup.model_params.n_latent: 80

#   Binaryvi_observed:
#     fixed:
#       model.model_type: "binaryvi"
#       setup.layer: None #using binary data
#       setup.model_params.n_latent: 60
#       setup.model_params.use_observed_lib_size: True


# Evaluation over multiple train,val, test sets for statistics using all batches
# Using best n_latent from initial sweep: see notebooks
Cross_validation_Satpathy:
  fixed:
    #data
    data.dataset: "satpathy"
    setup.label_key: "cell_type"
    setup.batch_key: "Group"
    data.batch: None

  Poissonvi_observed:
    fixed:
      model.model_type: "poissonvi"
      setup.layer: "counts" #using count layer
      setup.model_params.n_latent: 100
      setup.model_params.use_observed_lib_size: True

  Peakvi:
    fixed:
      model.model_type: "peakvi"
      setup.layer: None #using binary data
      setup.model_params.n_latent: 70

  Binaryvi_observed:
    fixed:
      model.model_type: "binaryvi"
      setup.layer: None #using binary data
      setup.model_params.n_latent: 100
      setup.model_params.use_observed_lib_size: True


CV_aerts:
  fixed:
    #data
    data.dataset: "aerts" #only testing on Neurips
    setup.batch_key: "runName"
    setup.label_key: "CellType_lvl1"
    data.batch: None

  Poissonvi:
    fixed:
      model.model_type: "poissonvi"
      setup.layer: "counts" #using count layer
      setup.model_params.n_latent: 60
      
  Peakvi:
    fixed:
      model.model_type: "peakvi"
      setup.layer: None #using binary data
      setup.model_params.n_latent: 70

  Binaryvi:
    fixed:
      model.model_type: "binaryvi"
      setup.layer: None #using binary data
      setup.model_params.n_latent: 50


CV_trapnell:
  fixed:
    #data
    data.dataset: "trapnell" #only testing on Neurips
    setup.batch_key: "sample_name"
    setup.label_key: "cell_type"
    data.batch: None

  Poissonvi:
    fixed:
      model.model_type: "poissonvi"
      setup.layer: "counts" #using count layer
      setup.model_params.n_latent: 100
      setup.model_params.use_observed_lib_size: True
      
  Peakvi:
    fixed:
      model.model_type: "peakvi"
      setup.layer: None #using binary data
      setup.model_params.n_latent: 100

  Binaryvi:
    fixed:
      model.model_type: "binaryvi"
      setup.layer: None #using binary data
      setup.model_params.n_latent: 100
      setup.model_params.use_observed_lib_size: True


